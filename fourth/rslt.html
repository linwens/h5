<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>沪杭国际教育新年签</title>
    <script src="./js/xxRem.js"></script>
    <script src="./js/zepto.min.js"></script>
    <script src="https://cdn.bootcss.com/html2canvas/0.5.0-beta4/html2canvas.js"></script>
    <link rel='stylesheet' href='./css/common.css' />
    <link rel='stylesheet' href='./css/animate.css' />
    <link rel="stylesheet" href="./css/style.css">
  </head>
  <body>
    <div class="Stick__body" id="J_capture">
      <div class="Stick__header f-pr">
        <img src="./img/logo.png" class="Stick__header-logo" alt="logo">
      </div>
      <div class="Stick__content Stick__content--rslt">
        <div class="Stick__content-rslt">
          <div class="Stick__content-txt rotate_L" id="J_txt"></div>
          <div class="Stick__content-stick rotate_R" id="J_stick"></div>
        </div>
        <div class="Stick__content-resolve" id="J_resolve"></div>
      </div>
      <div class="Stick__foot">
        <img src="./img/code.jpg" class="Stick__foot-code" alt="title">
        <div></div>
      </div>
    </div>
    <div id="J_save" class="Stick__canvas-box" style="display: none;"></div>
    <script>
      $(function(){
        var query = getQueryString('type');
        createStick(query)
        // 解签
        $('#J_resolve').click(function(){
          $('#J_stick, #J_txt').addClass('rotate');
          console.log($('#J_save'))
          setTimeout(createImg, 1000)
        })
      })
      // 获取传参
      function getQueryString(name){
          var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
          var r = window.location.search.substr(1).match(reg);
          if (r!=null)return  unescape(r[2]); return null;
      }
      // 生成签
      function createStick(type){
        var stick = $('#J_stick'),
            txt = $('#J_txt');
        stick.css('backgroundImage','url("./img/stick'+type+'.png")');
        txt.css('backgroundImage','url("./img/stick_txt'+type+'.png")');

      }
      // 生成图片
      function createImg() {
        var box = $('#J_save');
        html2canvas(document.querySelector("#J_capture"), {
          useCORS: true
        }).then(canvas => {
          console.log(canvas)
          // box.append(canvas);
          // box.show();
          // return
          var img = new Image();
              // img.setAttribute('crossOrigin', 'anonymous');
              img.src = canvas.toDataURL();
          console.log(img)
          box.append(img);
          box.show();
        });
      }
    </script>
  </body>
</html>